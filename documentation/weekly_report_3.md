# Weekly report 3

### What I have done during this week?

On sunday, after extended weekend break from the project, I mainly re-wrote and added new docstring and improved testing coverage. I also did some minor changes for some methods, such as renaming and re-ordering their structures.

On monday, I continued updating the docstring and did most of the unit tests for the current services. There are still some tests missing especially for the game services. I also added possibility to run two different levels of AI algorithms and checkings for the situation when game has ended in draw. On top of that, did some improvements for the UI, suchs as background image and logos. I know that it is not best way to spend time as it is not the primary scope for this project. However, I still have to run the software plenty of times and I'd like that it looks just little bit better. This being said, I still may update the game board and game coins looks, which should not take too much time.

On tuesday, I started creating some improvements for the UI such as drawing game board and coins. I expected that to be quick job to implement, but suddenly I realised spending almost whole evening for doing that. I am still not satisfied for the looks of the UI, but I decided to not spend more time on that as long as there are work left to do with the algorithms. Perhaps at the end of the project I may do some minor tuning if I have time left.

On wednesday I started finally implementing new stuff for the AI. I had studied earlier some methods to optimise Minimax algorithms and decided to give a go for iterative deepening. I think I managed to somehow do that, but I need to take a further look for that tomorrow and implement tests as well. I also managed to break one test for the game loop services which needs to be fixed.

Thursday was little bit lazy day in terms of project work. During the day I occasionally tried to read from the internet some new information related to the improvements of the AI algorithms. Mostly related to the bitboard presentation and transposition tables. I did not start yet implementing those since there are still some uncertainties which I want to discover first. However, I did minor improvement for the AI by changing the order how the available locations will be looped inside the Minimax algorithm. Instead starting from first available column from the left, I decided to start from the closest to the middle column and end to the closest columns at the sides. Reasons for this change was that, at least in the early stages, the optimal moves are more likely to be found at the middle. With this change, I was able to increase search depth from 6 up to 9 which took roughly 7-8 seconds at the early stage. However, I did not test what will happen after few starting rounds.

My main goal for Friday was to create prelimary testing document. Aside from that I did study bitboard presentation from Dominikus Herzbergs [Bitboards and Connect Four document](https://github.com/denkspuren/BitboardC4/blob/master/BitboardDesign.md) and after reading it couple of times, I decided to give it ago. I did very brief implementation and tests to check winning situation and judging by the results that seems to be working. I am still struggling to figure out proper way how to get most out of that, as full implementation at least, would require massive changes for the code base. On other hand, I would like to keep current matrix presentation available for the comparing purposes.

On saturday I decided to refactor the code so that I differentiated heuristic calculation from AI services into the own class. The reason for this was to keep AI services in reasonable size and to be able to create multiple kinds of heuristic calculation inside its own class. This refactoring involved changes for the test classes and also minor modifications to the testing document.

### How has the program progressed?

From the previous week I had plans to focus testing and verify that the AI services are working as intended. I think that in general I managed to finish all the goals set for this week even though the AI service testing could be a lot more thorough. I did not bother to do very thorough tests at the moment because many of test results involves calculation of the heuristic values and takes quite a chunk of time to count the values manually. This alone is not the problem, but I am quite sure that later I am going to make changes for the heuristic calculation and that would mean a massive number of manual re-calculations for the test results. For this same reason, I did not write very thorough testing document at this point. I feel that it will be more efficient to keep the document preliminary as long as there are going to be changes for the service classes and their tests.

On top of the testing, I created iterative deepening for the Minimax algorithm and started implementation of bitboard presentation. At the beginning of this week, I though that there will be plenty of time to make improvements and optimisation for the algorithm. However, after reading the project schedule for the incoming weeks, I realised that there are going to be quite some work for the documentation, peer reviewing and other stuff so it is better to do the improvements as soon as possible.

### What did I learn this week?

This week I spend time for investigating the possibilities how to optimise the AI algorithm. I mainly focused for understanding the bitboard presentation, iterative deepening and transposition table. It is too early to say that I have actually learned these methods very well, but at least I managed to create some sort of base for the first two mentioned methods. That being said, I guess I could say that I do at least know more about them than I did know a week ago. I also learned that better keep focusing on core areas of the project, because I ended up spending maybe 4 hours for UI improvements (for which I am not event very satisfied) which should have been spended for AI algorithm instead. That kind of thing should have been done at the later weeks if done at all.

### What was unclear or caused difficulties?

Generally, the implementation of the test and the testing document was quite clear. However, there are still some minor uncertainties how to make thorough testing for the AI services. The problem is that I can not make very deep manual calculations for the heuristic values and positions, as it would require exponential number of calculations for each depth added. I guess there is not much to do about these and I should focus more for preparing the test setups which would clearly end up for the terminal situations within certain number of moves. Also for the testing document, I am still little bit unsure how to create some sort of performance testing. Perhaps the simple idea could be just to create certain number of game situations and calculate next move for each situation and measure the time spend on those calculations by using different kind of methods, algorithms or search depths.

The biggest uncertainty on this week was how to continue improvements for the algorithm. I felt like implementation of the iterative deepening was the easiest one, so I started on that. I would have wanted to make transposition table as a next improvement, but I realised that I have no idea how to store game situations efficiently. I knew that bitboard presentation may solve this issue, but then again, it would require quite big changes for the current code base. I still decided to give a go for the bitboard presentation, but instead of making all the big changes immediately, I am going to do the changes in small iterations. For example currently, I do have some sort of hybrid version, where heuristic calculation are still made by using list matrix, but the terminal situations are made using the bitboard presentation. I am still having quite a huge question mark how to replicate the current heuristic calculations with bitboard. Currently, the heuristic calculations requires to check all 2 and 3 connects and I have no clue how to calculate these with bit operations efficiently. As I alternative option, I could change the heuristic calculation methods for bitboards so that they are only relying for the terminal situations, as proposed at [Solving connect 4: How to build a perfect AI](http://blog.gamesolver.org/solving-connect-four/02-test-protocol/).

### What do I do next?

Next week, there will be the first peer reviews for the project and I also have to start writing the project implementation document. On top of that, I am planning to continue with bitboard presentation and the goal is to have algorithm, which either solely uses list matrix or bitboards. If I can make that work, I would like to start implementating of the transposition table as well, but that may be too much to hope while considering the other activities, which needs to be done during the next week. Time will tell.